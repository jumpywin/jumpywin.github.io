# 用户管理

## 创建用户

```sql
create user if not exists 'user_nmae'@'localhost'#(限制的主机地址)
identified with mysql_native_password # 身份验证的方式
by'user_password' #用户密码
with
max_queries_per_hour
max_updates_per_hour
max_connections_per_hour
max_user_connections

```

`max_queries_per_hour`  
该参数设置一个用户在一小时内可以执行查询的次数（基本包含所有语句）
 
`max_updates_per_hour`  
该参数设置一个用户在一小时内可以执行修改的次数（仅包含修改数据库或表的语句）。
 
`max_connections_per_hour`  
该参数设置一个用户在一小时内可以连接MySQL的时间。
 
`max_user_connections`  
该参数作用是设置所有用户在同一时间连接MySQL实例的最大连接数限制。但这个参数无法对每个用户区别对待。

## 用户的权限授予与撤销
### 权限的授予
```
grant privilege_name on database_name.Table_name 
to 'user_name'@'主机地址'
```
将 table的privilege赋给user  
如果需要添加授权，则再次运行这条语句即为添加而不是覆盖。

- 可以通过授予权限的方式来创建用户
但是mySQL将在mySQL9时删除该功能（意思就是说不要用，要没了，可能有什么不太妙的地方）
```
grant privilege_name on database_name.Table_name 
to 'user_name'@'主机地址'
identified by 'password'
```

#### 一个典型的创建用户与授权的例子
```
grant insert,select,update,delete on ownSQL.*
to 'user1'@'localhost' identified '123456'
```
或许这一种创建用户的方式用的比较多，因为把创建用户和权限授予写在了一起，清晰也很简洁。

检查用户的权限
`show grants 'user_name'@'主机限制'`  
打印出该用户所拥有的各项权限。

### 权限的撤销
```sql
revoke privilege_name on database_name.table.name from
user_name @ '主机地址'
```
撤销权限与创建权限的语法相同。向用户授予权限用`to`，从用户撤销权限用`from`。

### 直接修改mysql.user表
这也是一种更改用户权限的一种方式，但是不会立即生效，需要手动重新载入改表才能生效。

### 设置用户密码有效期
`password expire`

- 手动设置用户密码为过期状态
```
alter user 'user_name'@'主机地址' password expire
```

-手动设置用户密码过期时间  
要求用户90天更换一次密码
```
alter user 'user_name'@'主机地址' password expire interval 90 day

```

### 锁定账户
`create user`或者`alt user`都可以使用`account lock`来锁定账户，用
`account unlock`来解锁账户


### 为用户创建角色
角色就是一系列权限的集合（`read_only`,`admin`...），可以为用户同时分配几个角色（即让一个用户同时担任多个角色）

- 创建两个角色 `read_only`,`root`
```
create role 'read_only','root'
```

- 为这两个角色分配权限
给角色分配权和给用户直接分配权限是一样的 使用`grant`命令。
```
grant select on `database_name`.`table_name` to read_only;
```

- 查询用户所拥有的角色？
没发现这样的命令，都是直接对user表进行的查询。